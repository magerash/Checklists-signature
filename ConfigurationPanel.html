<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ–¥–ø–∏—Å–∏</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    body {
      padding: 20px;
      background-color: #f5f5f5;
      color: #333;
    }
    
    .container {
      max-width: 100%;
    }
    
    h1 {
      color: #2c3e50;
      margin-bottom: 20px;
      font-size: 24px;
      border-bottom: 2px solid #3498db;
      padding-bottom: 10px;
    }
    
    .section {
      background-color: white;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .section-title {
      color: #3498db;
      margin-bottom: 15px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .section-title i {
      font-size: 20px;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 600;
      color: #555;
      font-size: 14px;
    }
    
    input[type="text"],
    input[type="number"],
    input[type="color"] {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    
    input[type="text"]:focus,
    input[type="number"]:focus {
      outline: none;
      border-color: #3498db;
      box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
    }
    
    .color-input-group {
      display: flex;
      align-items: center;
      gap: 10px;
    }
    
    .color-input-group input[type="color"] {
      width: 50px;
      height: 40px;
      padding: 2px;
      cursor: pointer;
    }
    
    .color-input-group input[type="text"] {
      flex: 1;
    }
    
    .buttons {
      display: flex;
      gap: 10px;
      margin-top: 20px;
    }
    
    button {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 4px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    
    #saveBtn {
      background-color: #2ecc71;
      color: white;
    }
    
    #saveBtn:hover {
      background-color: #27ae60;
    }
    
    #resetBtn {
      background-color: #e74c3c;
      color: white;
    }
    
    #resetBtn:hover {
      background-color: #c0392b;
    }
    
    #testBtn {
      background-color: #3498db;
      color: white;
    }
    
    #testBtn:hover {
      background-color: #2980b9;
    }
    
    .status-message {
      margin-top: 15px;
      padding: 10px;
      border-radius: 4px;
      font-size: 14px;
      display: none;
    }
    
    .success {
      background-color: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }
    
    .error {
      background-color: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }
    
    .info {
      background-color: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
      display: block;
    }
    
    .note {
      font-size: 12px;
      color: #7f8c8d;
      margin-top: 5px;
      font-style: italic;
    }
    
    .column-info {
      font-size: 12px;
      color: #3498db;
      margin-left: 5px;
      font-weight: normal;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –ø–æ–¥–ø–∏—Å–∏</h1>
    
    <div class="section">
      <div class="section-title">
        üìã –û—Å–Ω–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
      </div>
      
      <div class="form-group">
        <label for="SHEET_NAME">–ò–º—è —Ä–∞–±–æ—á–µ–≥–æ –ª–∏—Å—Ç–∞:</label>
        <input type="text" id="SHEET_NAME" name="SHEET_NAME" placeholder="dt_signs">
        <div class="note">–õ–∏—Å—Ç, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–∞–±–ª–∏—Ü–∞ —Å –ø–æ–¥–ø–∏—Å—è–º–∏</div>
      </div>
      
      <div class="form-group">
        <label for="DATA_RANGE_NAME">–ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞–Ω–Ω—ã—Ö:</label>
        <input type="text" id="DATA_RANGE_NAME" name="DATA_RANGE_NAME" placeholder="dt_sign_allData">
        <div class="note">–ò–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π –¥–∏–∞–ø–∞–∑–æ–Ω, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –¥–∞–Ω–Ω—ã–µ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö –∏ –ø–æ–¥–ø–∏—Å—è—Ö</div>
      </div>
    </div>
    
    <div class="section">
      <div class="section-title">
        üìä –°—Ç–æ–ª–±—Ü—ã
      </div>
      
      <div class="form-group">
        <label for="CHECKBOX_COLUMN">
          –°—Ç–æ–ª–±–µ—Ü —Å —á–µ–∫–±–æ–∫—Å–æ–º <span class="column-info">(–Ω–æ–º–µ—Ä: A=1, B=2, ...)</span>:
        </label>
        <input type="number" id="CHECKBOX_COLUMN" name="CHECKBOX_COLUMN" min="1" max="26">
        <div class="note">–°—Ç–æ–ª–±–µ—Ü, –≤ –∫–æ—Ç–æ—Ä–æ–º –Ω–∞—Ö–æ–¥—è—Ç—Å—è —á–µ–∫–±–æ–∫—Å—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –ø–æ–¥–ø–∏—Å–∏</div>
      </div>
      
      <div class="form-group">
        <label for="STATUS_COLUMN">
          –°—Ç–æ–ª–±–µ—Ü —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º <span class="column-info">(–Ω–æ–º–µ—Ä: A=1, B=2, ...)</span>:
        </label>
        <input type="number" id="STATUS_COLUMN" name="STATUS_COLUMN" min="1" max="26">
        <div class="note">–°—Ç–æ–ª–±–µ—Ü, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å—Ç–∞—Ç—É—Å –ø–æ–¥–ø–∏—Å–∏</div>
      </div>
    </div>
    
    <div class="section">
      <div class="section-title">
        üìà –î–∏–∞–ø–∞–∑–æ–Ω —Å—Ç—Ä–æ–∫
      </div>
      
      <div class="form-group">
        <label for="START_ROW">–ù–∞—á–∞–ª—å–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:</label>
        <input type="number" id="START_ROW" name="START_ROW" min="1">
        <div class="note">–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–±–æ–∫—Å–∞</div>
      </div>
      
      <div class="form-group">
        <label for="END_ROW">–ö–æ–Ω–µ—á–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏:</label>
        <input type="number" id="END_ROW" name="END_ROW" min="1">
        <div class="note">–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞, –≤ –∫–æ—Ç–æ—Ä–æ–π –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–µ–∫–±–æ–∫—Å–∞</div>
      </div>
    </div>
    
    <div class="section">
      <div class="section-title">
        ‚úèÔ∏è –¢–µ–∫—Å—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
      </div>
      
      <div class="form-group">
        <label for="DEFAULT_STATUS_TEXT">–¢–µ–∫—Å—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ —Å—Ç–æ–ª–±—Ü–µ —Å—Ç–∞—Ç—É—Å–∞:</label>
        <input type="text" id="DEFAULT_STATUS_TEXT" name="DEFAULT_STATUS_TEXT" placeholder="–ü–æ–¥–ø–∏—Å—å">
        <div class="note">–¢–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ —Å—Ç–æ–ª–±—Ü–µ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é</div>
      </div>
      
      <div class="form-group">
        <label for="DEFAULT_FONT_COLOR">–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:</label>
        <div class="color-input-group">
          <input type="color" id="DEFAULT_FONT_COLOR" name="DEFAULT_FONT_COLOR">
          <input type="text" id="DEFAULT_FONT_COLOR_HEX" name="DEFAULT_FONT_COLOR_HEX" placeholder="#000000">
        </div>
      </div>
    </div>
    
    <div class="section">
      <div class="section-title">
        üé® –¶–≤–µ—Ç–∞ —Å—Ç–∞—Ç—É—Å–æ–≤
      </div>
      
      <div class="form-group">
        <label for="COLOR_PROCESSING">–¶–≤–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞):</label>
        <div class="color-input-group">
          <input type="color" id="COLOR_PROCESSING" name="COLOR_PROCESSING">
          <input type="text" id="COLOR_PROCESSING_HEX" name="COLOR_PROCESSING_HEX" placeholder="#FFA500">
        </div>
      </div>
      
      <div class="form-group">
        <label for="COLOR_SUCCESS">–¶–≤–µ—Ç —É—Å–ø–µ—Ö–∞:</label>
        <div class="color-input-group">
          <input type="color" id="COLOR_SUCCESS" name="COLOR_SUCCESS">
          <input type="text" id="COLOR_SUCCESS_HEX" name="COLOR_SUCCESS_HEX" placeholder="#28a745">
        </div>
      </div>
      
      <div class="form-group">
        <label for="COLOR_ERROR">–¶–≤–µ—Ç –æ—à–∏–±–∫–∏:</label>
        <div class="color-input-group">
          <input type="color" id="COLOR_ERROR" name="COLOR_ERROR">
          <input type="text" id="COLOR_ERROR_HEX" name="COLOR_ERROR_HEX" placeholder="#dc3545">
        </div>
      </div>
    </div>
    
    <div class="buttons">
      <button id="saveBtn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      <button id="resetBtn">üîÑ –°–±—Ä–æ—Å–∏—Ç—å</button>
      <button id="testBtn">‚úÖ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
    </div>
    
    <div id="statusMessage" class="status-message"></div>
  </div>

  <script>
    // Load configuration when page loads
    document.addEventListener('DOMContentLoaded', function() {
      loadConfiguration();
      setupEventListeners();
    });
    
    function loadConfiguration() {
      google.script.run
        .withSuccessHandler(function(config) {
          // Fill form with current configuration
          document.getElementById('SHEET_NAME').value = config.SHEET_NAME || '';
          document.getElementById('DATA_RANGE_NAME').value = config.DATA_RANGE_NAME || '';
          document.getElementById('CHECKBOX_COLUMN').value = config.CHECKBOX_COLUMN || '';
          document.getElementById('STATUS_COLUMN').value = config.STATUS_COLUMN || '';
          document.getElementById('START_ROW').value = config.START_ROW || '';
          document.getElementById('END_ROW').value = config.END_ROW || '';
          document.getElementById('DEFAULT_STATUS_TEXT').value = config.DEFAULT_STATUS_TEXT || '';
          document.getElementById('DEFAULT_FONT_COLOR').value = config.DEFAULT_FONT_COLOR || '#000000';
          document.getElementById('DEFAULT_FONT_COLOR_HEX').value = config.DEFAULT_FONT_COLOR || '#000000';
          document.getElementById('COLOR_PROCESSING').value = config.COLOR_PROCESSING || '#FFA500';
          document.getElementById('COLOR_PROCESSING_HEX').value = config.COLOR_PROCESSING || '#FFA500';
          document.getElementById('COLOR_SUCCESS').value = config.COLOR_SUCCESS || '#28a745';
          document.getElementById('COLOR_SUCCESS_HEX').value = config.COLOR_SUCCESS || '#28a745';
          document.getElementById('COLOR_ERROR').value = config.COLOR_ERROR || '#dc3545';
          document.getElementById('COLOR_ERROR_HEX').value = config.COLOR_ERROR || '#dc3545';
        })
        .withFailureHandler(function(error) {
          showMessage('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: ' + error.message, 'error');
        })
        .loadConfigForPanel();
    }
    
    function setupEventListeners() {
      // Save button
      document.getElementById('saveBtn').addEventListener('click', saveConfiguration);
      
      // Reset button
      document.getElementById('resetBtn').addEventListener('click', resetConfiguration);
      
      // Test button
      document.getElementById('testBtn').addEventListener('click', testConfiguration);
      
      // Color picker sync with hex input
      document.getElementById('DEFAULT_FONT_COLOR').addEventListener('input', function(e) {
        document.getElementById('DEFAULT_FONT_COLOR_HEX').value = e.target.value;
      });
      
      document.getElementById('COLOR_PROCESSING').addEventListener('input', function(e) {
        document.getElementById('COLOR_PROCESSING_HEX').value = e.target.value;
      });
      
      document.getElementById('COLOR_SUCCESS').addEventListener('input', function(e) {
        document.getElementById('COLOR_SUCCESS_HEX').value = e.target.value;
      });
      
      document.getElementById('COLOR_ERROR').addEventListener('input', function(e) {
        document.getElementById('COLOR_ERROR_HEX').value = e.target.value;
      });
      
      // Hex input sync with color picker
      document.getElementById('DEFAULT_FONT_COLOR_HEX').addEventListener('input', function(e) {
        document.getElementById('DEFAULT_FONT_COLOR').value = e.target.value;
      });
      
      document.getElementById('COLOR_PROCESSING_HEX').addEventListener('input', function(e) {
        document.getElementById('COLOR_PROCESSING').value = e.target.value;
      });
      
      document.getElementById('COLOR_SUCCESS_HEX').addEventListener('input', function(e) {
        document.getElementById('COLOR_SUCCESS').value = e.target.value;
      });
      
      document.getElementById('COLOR_ERROR_HEX').addEventListener('input', function(e) {
        document.getElementById('COLOR_ERROR').value = e.target.value;
      });
    }
    
    function saveConfiguration() {
      const config = {
        SHEET_NAME: document.getElementById('SHEET_NAME').value,
        DATA_RANGE_NAME: document.getElementById('DATA_RANGE_NAME').value,
        CHECKBOX_COLUMN: parseInt(document.getElementById('CHECKBOX_COLUMN').value),
        STATUS_COLUMN: parseInt(document.getElementById('STATUS_COLUMN').value),
        START_ROW: parseInt(document.getElementById('START_ROW').value),
        END_ROW: parseInt(document.getElementById('END_ROW').value),
        DEFAULT_STATUS_TEXT: document.getElementById('DEFAULT_STATUS_TEXT').value,
        DEFAULT_FONT_COLOR: document.getElementById('DEFAULT_FONT_COLOR').value,
        COLOR_PROCESSING: document.getElementById('COLOR_PROCESSING').value,
        COLOR_SUCCESS: document.getElementById('COLOR_SUCCESS').value,
        COLOR_ERROR: document.getElementById('COLOR_ERROR').value
      };
      
      google.script.run
        .withSuccessHandler(function(response) {
          showMessage(response.message, 'success');
        })
        .withFailureHandler(function(error) {
          showMessage('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è: ' + error.message, 'error');
        })
        .saveConfig(config);
    }
    
    function resetConfiguration() {
      if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫ –∑–Ω–∞—á–µ–Ω–∏—è–º –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é?')) {
        google.script.run
          .withSuccessHandler(function(response) {
            showMessage(response.message, 'success');
            // Reload configuration after reset
            setTimeout(loadConfiguration, 1000);
          })
          .withFailureHandler(function(error) {
            showMessage('–û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞: ' + error.message, 'error');
          })
          .resetConfig();
      }
    }
    
    function testConfiguration() {
      google.script.run
        .withSuccessHandler(function(response) {
          if (response.success) {
            const details = response.details;
            const message = `–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!\n\n` +
                           `üìÑ –õ–∏—Å—Ç: ${details.sheet}\n` +
                           `üìä –î–∏–∞–ø–∞–∑–æ–Ω –¥–∞–Ω–Ω—ã—Ö: ${details.dataRange}\n` +
                           `üìà –°—Ç—Ä–æ–∫–∏: ${details.rows}\n` +
                           `‚úÖ –°—Ç–æ–ª–±–µ—Ü —á–µ–∫–±–æ–∫—Å–∞: ${details.checkboxColumn}\n` +
                           `üìã –°—Ç–æ–ª–±–µ—Ü —Å—Ç–∞—Ç—É—Å–∞: ${details.statusColumn}`;
            showMessage(message, 'info');
          } else {
            showMessage('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏', 'error');
          }
        })
        .withFailureHandler(function(error) {
          showMessage('–û—à–∏–±–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏: ' + error.message, 'error');
        })
        .testConfiguration();
    }
    
    function showMessage(message, type) {
      const statusDiv = document.getElementById('statusMessage');
      statusDiv.textContent = message;
      statusDiv.className = 'status-message ' + type;
      statusDiv.style.display = 'block';
      
      // Auto-hide success messages after 5 seconds
      if (type === 'success') {
        setTimeout(function() {
          statusDiv.style.display = 'none';
        }, 5000);
      }
    }
  </script>
</body>
</html>